<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HTML para PNG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/3.3.1/dom-to-image-more.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <style>
        body, html { height: 100%; overflow: hidden; }
        .preview-content { padding-bottom: 180px; } 

        /* UI Elements */
        .cut-line {
            position: absolute; left: 0; right: 0; height: 2px;
            background-color: #ef4444; z-index: 50; pointer-events: auto;
            display: flex; align-items: center; justify-content: flex-end;
            padding-right: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .cut-remove {
            background: #ef4444; color: white; border-radius: 50%;
            width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
            font-size: 10px; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .cut-remove:hover { transform: scale(1.1); }
        .cutting-mode { cursor: crosshair; }

        /* Branding */
        .glow-text { text-shadow: 0 0 8px rgba(185, 28, 28, 0.4); }

        /* Tooltip */
        .tooltip-trigger:hover::after {
            content: attr(data-tooltip);
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #2563eb; color: white; padding: 4px 8px; border-radius: 4px;
            font-size: 10px; white-space: nowrap; margin-bottom: 5px; z-index: 100;
            pointer-events: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .tooltip-trigger:hover::before {
            content: ''; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            border-width: 4px; border-style: solid; border-color: #2563eb transparent transparent transparent;
            margin-bottom: -3px; z-index: 100;
        }
        .tooltip-trigger { position: relative; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 flex flex-col h-full text-slate-800 dark:text-slate-200 font-sans transition-colors duration-300">

    <!-- Header -->
    <div class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 py-2 shadow-sm shrink-0 z-30 flex justify-between items-center h-14 transition-colors">
        <h1 class="font-bold text-slate-700 dark:text-slate-200 text-sm tracking-tight">HTML para PNG <span class="text-xs font-normal text-slate-400 dark:text-slate-500">Mobile</span></h1>
        
        <div class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg transition-colors">
            <button onclick="switchTab('editor')" id="tab-editor" 
                class="px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm">
                EDITOR
            </button>
            <button onclick="switchTab('preview')" id="tab-preview" 
                class="px-4 py-1.5 rounded-md text-xs font-bold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200">
                PREVIEW
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-grow relative overflow-hidden flex flex-col">
        
        <!-- Editor View -->
        <div id="view-editor" class="absolute inset-0 flex flex-col p-2 transition-opacity duration-200 z-10 bg-slate-50 dark:bg-slate-950">
            <textarea id="code-input" 
                class="flex-grow w-full p-4 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 font-mono text-xs leading-relaxed resize-none focus:outline-none focus:border-blue-500 dark:focus:border-blue-500 shadow-inner text-slate-800 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-600 transition-colors"
                placeholder="Cole seu c√≥digo HTML aqui..." 
                spellcheck="false"></textarea>
        </div>

        <!-- Preview View -->
        <div id="view-preview" class="absolute inset-0 flex-col bg-slate-200 dark:bg-slate-950 hidden z-10 transition-colors">
            <div class="flex-grow overflow-y-auto overflow-x-hidden flex justify-center items-start p-4 preview-content w-full" id="scroll-container">
                <!-- Wrapper mantido branco para representar o papel -->
                <div id="iframe-wrapper" class="bg-white shadow-xl transition-all duration-300 origin-top shrink-0 relative" style="width: 400px;">
                    <iframe id="preview-frame" class="w-full border-none bg-white block" scrolling="no"></iframe>
                    <div id="cut-overlay" class="absolute inset-0 z-40 hidden" onclick="addCut(event)"></div>
                    <div id="cut-lines-container" class="absolute inset-0 z-50 pointer-events-none"></div>
                </div>
            </div>

            <!-- Action Bars -->
            <div id="action-bars-container" class="absolute bottom-4 left-0 right-0 z-50 px-4 pointer-events-none flex flex-col items-center gap-2">
                <!-- Default Bar -->
                <div id="bar-default" class="bg-white/95 dark:bg-slate-900/95 backdrop-blur border border-slate-200 dark:border-slate-700 p-2 rounded-2xl shadow-xl flex gap-2 pointer-events-auto max-w-md w-full transition-colors">
                    <button onclick="startCutMode()" class="flex-1 bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/30 dark:hover:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 px-3 py-3 rounded-xl font-bold text-xs flex items-center justify-center gap-2 transition active:scale-95 border border-indigo-200 dark:border-indigo-800 tooltip-trigger" data-tooltip="Modo de corte manual">
                        <i class="fa-solid fa-scissors"></i> Cortes
                    </button>
                    <button onclick="downloadFull()" class="flex-[2] bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500 text-white px-3 py-3 rounded-xl font-bold text-xs flex items-center justify-center gap-2 shadow-md transition active:scale-95 tooltip-trigger" data-tooltip="Baixar imagem inteira">
                        <i class="fa-solid fa-download"></i> Baixar PNG
                    </button>
                </div>

                <!-- Cutting Bar -->
                <div id="bar-cutting" class="bg-slate-800/95 dark:bg-slate-900/95 backdrop-blur border border-slate-700 dark:border-slate-600 p-3 rounded-2xl shadow-2xl flex flex-col gap-2 pointer-events-auto hidden max-w-md w-full transition-colors">
                    <div class="text-center text-slate-300 dark:text-slate-400 text-[10px] mb-1">
                        <i class="fa-solid fa-arrow-pointer"></i> Toque na imagem para marcar cortes
                    </div>
                    <div class="flex gap-2">
                        <button onclick="cancelCutMode()" class="flex-1 bg-slate-700 hover:bg-slate-600 dark:bg-slate-800 dark:hover:bg-slate-700 text-white px-3 py-2 rounded-lg font-bold text-xs transition active:scale-95">
                            Cancelar
                        </button>
                        <button onclick="downloadManualSlices()" class="flex-[2] bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-bold text-xs flex items-center justify-center gap-2 shadow-md transition active:scale-95">
                            <i class="fa-solid fa-file-zipper"></i> Baixar ZIP
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 py-2 px-4 shrink-0 z-20 flex flex-col items-center shadow-[0_-5px_15px_rgba(0,0,0,0.02)] transition-colors">
        <div class="flex gap-4 justify-center items-center w-full mb-2">
            <button onclick="openReadmeModal()" class="text-[10px] font-bold text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 flex items-center gap-1.5 transition tooltip-trigger" data-tooltip="Ver instru√ß√µes de uso">
                <i class="fa-solid fa-circle-info"></i> Documenta√ß√£o
            </button>
            <div class="w-px h-3 bg-slate-200 dark:bg-slate-700"></div>
            <button onclick="downloadApp()" class="text-[10px] font-bold text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 flex items-center gap-1.5 transition tooltip-trigger" data-tooltip="Baixar este site (Limpo)">
                <i class="fa-solid fa-floppy-disk"></i> Salvar App
            </button>
        </div>
        <div class="text-center leading-none">
            <div class="text-[9px] text-slate-400 dark:text-slate-500 mb-0.5">
                desenvolvido por <span class="font-black text-red-900 dark:text-red-500 glow-text tracking-wide ml-0.5">FGC</span>
            </div>
            <div class="text-[8px] text-slate-300 dark:text-slate-600 font-mono select-all">escrevaprofernando@gmail.com</div>
            <div class="text-[8px] text-slate-300 dark:text-slate-600 font-mono mt-0.5 select-all"><span class="font-bold text-slate-400 dark:text-slate-500">PIX:</span> 00833238132</div>
        </div>
    </div>

    <!-- Readme Modal -->
    <div id="readme-modal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 w-full max-w-2xl max-h-[85vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-[fadeIn_0.2s_ease-out] transition-colors">
            <div class="bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 px-4 py-3 flex justify-between items-center shrink-0">
                <h2 class="font-bold text-slate-700 dark:text-slate-200 text-sm"><i class="fa-solid fa-book text-blue-500 mr-2"></i> Documenta√ß√£o</h2>
                <button onclick="closeReadmeModal()" class="text-slate-400 hover:text-red-500 dark:text-slate-500 dark:hover:text-red-400 w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 transition"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 overflow-y-auto text-sm text-slate-600 dark:text-slate-300 leading-relaxed space-y-4 font-sans">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white">üì± Exportador HTML para PNG Mobile</h3>
                <p>Ferramenta para converter c√≥digo HTML em imagens PNG de alta fidelidade.</p>
                <hr class="border-slate-200 dark:border-slate-700">
                <h4 class="font-bold text-slate-700 dark:text-slate-200">‚ú® Funcionalidades</h4>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>Motor SVG:</strong> Renderiza√ß√£o perfeita de fontes e √≠cones.</li>
                    <li><strong>Qualidade Retina:</strong> Imagens 2x mais n√≠tidas.</li>
                    <li><strong>Fatiamento Manual:</strong> Corte imagens longas com precis√£o.</li>
                    <li><strong>ZIP Autom√°tico:</strong> Baixe fatias agrupadas.</li>
                </ul>
                <h4 class="font-bold text-slate-700 dark:text-slate-200">üöÄ Como Usar</h4>
                <ol class="list-decimal pl-5 space-y-1">
                    <li>Cole seu HTML na aba <strong>Editor</strong>.</li>
                    <li>V√° para a aba <strong>Preview</strong>.</li>
                    <li>Escolha <strong>Baixar PNG</strong> para imagem √∫nica.</li>
                    <li>Escolha <strong>Cortes</strong> para fatiar manualmente:
                        <ul class="list-disc pl-5 mt-1 text-slate-500 dark:text-slate-400">
                            <li>Toque na imagem para criar linhas de corte.</li>
                            <li>Use o "X" para remover uma linha.</li>
                            <li>Clique em <strong>Baixar ZIP</strong>.</li>
                        </ul>
                    </li>
                </ol>
            </div>
            <div class="bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 px-4 py-3 flex justify-end shrink-0">
                <button onclick="closeReadmeModal()" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg text-xs font-bold transition">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-black/70 z-[110] flex items-center justify-center hidden backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-2xl flex flex-col items-center gap-4 animate-bounce-small transition-colors">
            <div class="animate-spin rounded-full h-10 w-10 border-[3px] border-blue-600 border-t-transparent"></div>
            <span id="loading-text" class="text-sm font-bold text-slate-700 dark:text-slate-200">Processando...</span>
        </div>
    </div>

    <script>
        // --- Refer√™ncias ---
        const els = {
            editor: document.getElementById('view-editor'),
            preview: document.getElementById('view-preview'),
            tabEditor: document.getElementById('tab-editor'),
            tabPreview: document.getElementById('tab-preview'),
            input: document.getElementById('code-input'),
            iframe: document.getElementById('preview-frame'),
            iframeWrapper: document.getElementById('iframe-wrapper'),
            loading: document.getElementById('loading'),
            loadingText: document.getElementById('loading-text'),
            barDefault: document.getElementById('bar-default'),
            barCutting: document.getElementById('bar-cutting'),
            cutOverlay: document.getElementById('cut-overlay'),
            cutLinesContainer: document.getElementById('cut-lines-container'),
            readmeModal: document.getElementById('readme-modal')
        };

        let iframeDoc = null;
        let manualCuts = []; 

        // --- Core Functions ---
        function getBaseName() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            return `jogos_do_dia-${day}-${month}-${year}-FGC`;
        }

        function generateFilename(extension) {
            return `${getBaseName()}.${extension}`;
        }

        function sanitizeHtml(html) {
            return html.replace(
                /<link([^>]+)href=["']([^"']+)["']([^>]*)/gi, 
                (match, p1, url, p3) => {
                    if (match.includes('crossorigin')) return match;
                    if (match.includes('rel="stylesheet"') || match.includes("rel='stylesheet'")) {
                        return `<link${p1}href="${url}"${p3} crossorigin="anonymous"`;
                    }
                    return match;
                }
            );
        }

        // --- Navega√ß√£o ---
        function switchTab(tab) {
            if (tab === 'editor') {
                els.editor.classList.remove('hidden'); 
                els.editor.classList.remove('pointer-events-none', 'opacity-0');
                els.preview.classList.add('hidden');
                
                updateTabStyle(els.tabEditor, true);
                updateTabStyle(els.tabPreview, false);
                cancelCutMode();
            } else {
                if(!els.input.value.trim()) { alert('Cole o HTML primeiro.'); return; }
                
                els.editor.classList.add('hidden');
                els.preview.classList.remove('hidden');
                els.preview.classList.add('flex');
                
                updateTabStyle(els.tabEditor, false);
                updateTabStyle(els.tabPreview, true);
                
                updatePreview();
            }
        }

        function updateTabStyle(btn, active) {
            // L√≥gica para Dark Mode nos bot√µes de aba
            if(active) {
                // Ativo: Fundo branco/escuro, texto azul
                btn.className = "px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm";
            } else {
                // Inativo: Texto cinza
                btn.className = "px-4 py-1.5 rounded-md text-xs font-bold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200";
            }
        }

        // --- Modais ---
        function openReadmeModal() { els.readmeModal.classList.remove('hidden'); }
        function closeReadmeModal() { els.readmeModal.classList.add('hidden'); }
        
        function downloadApp() {
            const currentCode = els.input.value;
            els.input.innerHTML = ''; 
            els.input.value = '';
            
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'exportador-fgc-mobile.html';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            els.input.value = currentCode;
        }

        // --- Preview Logic ---
        function updatePreview() {
            let html = els.input.value;
            html = sanitizeHtml(html);
            els.iframeWrapper.style.width = '400px';

            iframeDoc = els.iframe.contentDocument || els.iframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(html);
            iframeDoc.write(`
                <style>
                    html, body { margin: 0; padding: 0; -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
                    * { box-sizing: border-box; }
                    ::-webkit-scrollbar { display: none; }
                </style>
            `);
            iframeDoc.close();

            els.iframe.onload = resizeIframe;
            setTimeout(resizeIframe, 500);
        }

        function resizeIframe() {
            if(!iframeDoc) return;
            const height = Math.max(iframeDoc.body.scrollHeight, iframeDoc.documentElement.scrollHeight);
            els.iframe.style.height = height + 'px';
            els.iframeWrapper.style.height = height + 'px';
        }

        // --- Cutting Logic ---
        function startCutMode() {
            els.barDefault.classList.add('hidden');
            els.barCutting.classList.remove('hidden');
            els.barCutting.classList.add('flex');
            els.cutOverlay.classList.remove('hidden');
            els.iframeWrapper.classList.add('cutting-mode');
            manualCuts = [];
            renderCuts();
            document.getElementById('scroll-container').scrollTop = 0;
        }

        function cancelCutMode() {
            els.barDefault.classList.remove('hidden');
            els.barCutting.classList.add('hidden');
            els.barCutting.classList.remove('flex');
            els.cutOverlay.classList.add('hidden');
            els.iframeWrapper.classList.remove('cutting-mode');
            manualCuts = [];
            renderCuts();
        }

        function addCut(event) {
            const rect = els.iframeWrapper.getBoundingClientRect();
            const y = event.clientY - rect.top;
            if (y < 0 || y > els.iframeWrapper.offsetHeight) return;
            manualCuts.push(y);
            manualCuts.sort((a, b) => a - b);
            renderCuts();
        }

        function removeCut(index) {
            manualCuts.splice(index, 1);
            renderCuts();
            event.stopPropagation();
        }

        function renderCuts() {
            els.cutLinesContainer.innerHTML = '';
            manualCuts.forEach((y, index) => {
                const line = document.createElement('div');
                line.className = 'cut-line';
                line.style.top = y + 'px';
                const btn = document.createElement('div');
                btn.className = 'cut-remove';
                btn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
                btn.onclick = (e) => { e.stopPropagation(); removeCut(index); };
                line.appendChild(btn);
                els.cutLinesContainer.appendChild(line);
            });
        }

        // --- Export Logic ---
        async function generateCanvas() {
            const node = iframeDoc.documentElement;
            const width = 400;
            const height = els.iframeWrapper.offsetHeight;
            const scale = 2; 

            const config = {
                width: width * scale,
                height: height * scale,
                style: {
                    transform: `scale(${scale})`,
                    transformOrigin: 'top left',
                    width: `${width}px`,
                    height: `${height}px`
                }
            };

            try {
                const dataUrl = await domtoimage.toPng(node, config);
                const img = new Image();
                img.src = dataUrl;
                await new Promise(r => img.onload = r);
                const canvas = document.createElement('canvas');
                canvas.width = width * scale;
                canvas.height = height * scale;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                return canvas;
            } catch (err) {
                console.error("Erro dom-to-image:", err);
                throw err;
            }
        }

        async function downloadManualSlices() {
            if (manualCuts.length === 0) {
                if(confirm("Sem cortes. Baixar inteiro?")) downloadFull();
                return;
            }
            showLoading("Fatiando (Alta Fidelidade)...");
            await new Promise(r => setTimeout(r, 800));

            try {
                const fullCanvas = await generateCanvas();
                const totalHeight = fullCanvas.height;
                const width = fullCanvas.width;
                const scale = fullCanvas.width / 400; 
                
                const zip = new JSZip();
                const cuts = [0, ...manualCuts.map(c => c * scale), totalHeight];
                const uniqueCuts = [...new Set(cuts)].sort((a, b) => a - b);
                
                const baseName = getBaseName();
                let part = 1;

                for (let i = 0; i < uniqueCuts.length - 1; i++) {
                    const startY = uniqueCuts[i];
                    const endY = uniqueCuts[i+1];
                    const sliceHeight = endY - startY;
                    if (sliceHeight <= 1) continue;

                    const sliceCanvas = document.createElement('canvas');
                    sliceCanvas.width = width;
                    sliceCanvas.height = sliceHeight;
                    const ctx = sliceCanvas.getContext('2d');
                    ctx.drawImage(fullCanvas, 0, startY, width, sliceHeight, 0, 0, width, sliceHeight);

                    const imgData = sliceCanvas.toDataURL("image/png").split(',')[1];
                    const sliceName = `${baseName}-${String(part).padStart(3, '0')}.png`;
                    zip.file(sliceName, imgData, {base64: true});
                    part++;
                }

                showLoading("Compactando...");
                const content = await zip.generateAsync({type:"blob"});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `${baseName}.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                cancelCutMode();
            } catch (err) {
                console.error(err);
                alert("Erro ao processar fatias.");
            } finally {
                hideLoading();
            }
        }

        async function downloadFull() {
            showLoading("Gerando PNG...");
            await new Promise(r => setTimeout(r, 800));
            try {
                const canvas = await generateCanvas();
                const link = document.createElement('a');
                link.download = generateFilename('png');
                link.href = canvas.toDataURL("image/png");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (err) {
                console.error(err);
                alert("Erro ao gerar imagem.");
            } finally {
                hideLoading();
            }
        }

        function showLoading(msg) {
            els.loadingText.innerText = msg;
            els.loading.classList.remove('hidden');
        }
        function hideLoading() {
            els.loading.classList.add('hidden');
        }

        // Persist√™ncia
        const saved = localStorage.getItem('saved_html');
        if(saved) els.input.value = saved;
        els.input.addEventListener('input', () => localStorage.setItem('saved_html', els.input.value));
    </script>
</body>
</html>
